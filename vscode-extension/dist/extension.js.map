{
  "version": 3,
  "sources": ["../src/extension.ts"],
  "sourcesContent": ["import * as vscode from 'vscode';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { execSync } from 'child_process';\n\n// ---------------------------------------------------------------------------\n// Data types\n// ---------------------------------------------------------------------------\n\ninterface TraceRecord {\n    call_id: string;\n    function: string;\n    op_name: string | null;\n    wandb_url: string | null;\n    source_file: string | null;\n    source_line_start: number | null;\n    source_line_end: number | null;\n    timestamp_start: number;\n    duration_s: number;\n    inputs: Record<string, unknown>;\n    output: unknown;\n    error: { type: string; message: string; traceback: string } | string | null;\n    git_repo_root: string | null;\n    git_commit: string | null;\n    git_dirty: boolean;\n    git_snapshot_sha: string | null;\n}\n\ninterface TraceStore {\n    activeRunId: string | null;\n    runTraces: Map<string, TraceRecord[]>;\n    selectedCallId: string | null;\n    focusedFn: string | null;\n    suppressCursorFilter: boolean;\n    highlightActive: boolean;\n}\n\n// ---------------------------------------------------------------------------\n// Utility functions\n// ---------------------------------------------------------------------------\n\nfunction parseRunLabel(stem: string): string {\n    const parts = stem.split('_');\n    if (parts.length >= 2) {\n        const date = parts[0];\n        const timePart = parts[1];\n        if (date.length === 8 && timePart.length === 6) {\n            return `${date.slice(0, 4)}-${date.slice(4, 6)}-${date.slice(6)} ${timePart.slice(0, 2)}:${timePart.slice(2, 4)}:${timePart.slice(4)}`;\n        }\n    }\n    return stem;\n}\n\nfunction normaliseTrace(raw: Record<string, unknown>): TraceRecord {\n    let fnName = (raw['function'] as string) ?? null;\n    if (!fnName && raw['op_name']) {\n        const opName = raw['op_name'] as string;\n        fnName = opName.split('/').pop()?.split(':')[0] ?? opName;\n    }\n    return {\n        call_id: raw['call_id'] as string,\n        function: fnName ?? '(unknown)',\n        op_name: (raw['op_name'] as string) ?? null,\n        wandb_url: (raw['wandb_url'] as string) ?? null,\n        source_file: (raw['source_file'] as string) ?? null,\n        source_line_start: (raw['source_line_start'] as number) ?? null,\n        source_line_end: (raw['source_line_end'] as number) ?? null,\n        timestamp_start: raw['timestamp_start'] as number,\n        duration_s: (raw['duration_s'] as number) ?? 0,\n        inputs: (raw['inputs'] as Record<string, unknown>) ?? {},\n        output: raw['output'] ?? null,\n        error: (raw['error'] as TraceRecord['error']) ?? null,\n        git_repo_root: (raw['git_repo_root'] as string) ?? null,\n        git_commit: (raw['git_commit'] as string) ?? null,\n        git_dirty: (raw['git_dirty'] as boolean) ?? false,\n        git_snapshot_sha: (raw['git_snapshot_sha'] as string) ?? null,\n    };\n}\n\nfunction loadTracesFromFile(filePath: string): TraceRecord[] {\n    if (!fs.existsSync(filePath)) { return []; }\n    let content: string;\n    try { content = fs.readFileSync(filePath, 'utf8'); } catch { return []; }\n    const traces: TraceRecord[] = [];\n    for (const line of content.split('\\n')) {\n        const trimmed = line.trim();\n        if (!trimmed) { continue; }\n        try { traces.push(normaliseTrace(JSON.parse(trimmed))); } catch { /* skip malformed */ }\n    }\n    traces.sort((a, b) => (a.timestamp_start || 0) - (b.timestamp_start || 0));\n    return traces;\n}\n\nfunction traceUrl(trace: TraceRecord): string | null {\n    return trace.wandb_url ?? null;\n}\n\nfunction getRunsDir(): string | null {\n    const folders = vscode.workspace.workspaceFolders;\n    if (!folders || folders.length === 0) { return null; }\n    // Find the first workspace folder that actually has a runs/ directory\n    for (const folder of folders) {\n        const candidate = path.join(folder.uri.fsPath, 'runs');\n        if (fs.existsSync(candidate)) { return candidate; }\n    }\n    // Fall back to first folder (runs/ doesn't exist yet)\n    return path.join(folders[0].uri.fsPath, 'runs');\n}\n\n// ---------------------------------------------------------------------------\n// Git helpers\n// ---------------------------------------------------------------------------\n\ninterface RunGitState {\n    git_repo_root: string | null;\n    git_commit: string | null;\n    git_dirty: boolean;\n    git_snapshot_sha: string | null;\n}\n\nfunction getRunGitState(runId: string): RunGitState | null {\n    const runsDir = getRunsDir();\n    if (!runsDir) { return null; }\n    const filePath = path.join(runsDir, `${runId}.jsonl`);\n    if (!fs.existsSync(filePath)) { return null; }\n    let content: string;\n    try { content = fs.readFileSync(filePath, 'utf8'); } catch { return null; }\n    for (const line of content.split('\\n')) {\n        const trimmed = line.trim();\n        if (!trimmed) { continue; }\n        try {\n            const raw = JSON.parse(trimmed);\n            return {\n                git_repo_root: (raw['git_repo_root'] as string) ?? null,\n                git_commit: (raw['git_commit'] as string) ?? null,\n                git_dirty: (raw['git_dirty'] as boolean) ?? false,\n                git_snapshot_sha: (raw['git_snapshot_sha'] as string) ?? null,\n            };\n        } catch { continue; }\n    }\n    return null;\n}\n\nfunction runGit(args: string[], cwd: string): string {\n    return execSync(['git', ...args].join(' '), { cwd, encoding: 'utf8' }).trim();\n}\n\n// ---------------------------------------------------------------------------\n// Tree items\n// ---------------------------------------------------------------------------\n\nclass TraceRunItem extends vscode.TreeItem {\n    public readonly gitState: RunGitState | null;\n\n    constructor(public readonly runId: string) {\n        super(parseRunLabel(runId), vscode.TreeItemCollapsibleState.Collapsed);\n        this.gitState = getRunGitState(runId);\n        const gs = this.gitState;\n        if (gs?.git_commit) {\n            const dirtyMark = gs.git_dirty ? '*' : '';\n            this.description = `${gs.git_commit}${dirtyMark}${gs.git_snapshot_sha ? '  \uD83D\uDCF8' : ''}`;\n        }\n        this.iconPath = new vscode.ThemeIcon('history');\n        this.contextValue = gs?.git_snapshot_sha ? 'traceRunWithSnapshot' : 'traceRun';\n    }\n}\n\nclass TraceCallItem extends vscode.TreeItem {\n    constructor(\n        public readonly trace: TraceRecord,\n        public readonly runId: string,\n        selected = false\n    ) {\n        super(trace.function, vscode.TreeItemCollapsibleState.None);\n        this.description = `${trace.duration_s.toFixed(3)}s${trace.wandb_url ? '  \uD83C\uDF69' : ''}`;\n        if (selected) {\n            this.iconPath = new vscode.ThemeIcon('arrow-right', new vscode.ThemeColor('charts.yellow'));\n        } else if (trace.error) {\n            this.iconPath = new vscode.ThemeIcon('circle-filled', new vscode.ThemeColor('charts.red'));\n        } else {\n            this.iconPath = new vscode.ThemeIcon('circle-filled', new vscode.ThemeColor('charts.green'));\n        }\n        this.command = {\n            command: 'cdweave.selectTrace',\n            title: 'Select Trace',\n            arguments: [this],\n        };\n        this.contextValue = trace.wandb_url ? 'traceCallWithUrl' : 'traceCall';\n    }\n}\n\n// ---------------------------------------------------------------------------\n// TraceTreeProvider\n// ---------------------------------------------------------------------------\n\nclass TraceTreeProvider implements vscode.TreeDataProvider<TraceRunItem | TraceCallItem> {\n    private _onDidChangeTreeData = new vscode.EventEmitter<TraceRunItem | TraceCallItem | undefined | null | void>();\n    readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n    constructor(private readonly store: TraceStore) {}\n\n    refresh(): void {\n        const runsDir = getRunsDir();\n        if (runsDir) {\n            try {\n                const files = fs.readdirSync(runsDir)\n                    .filter(f => f.endsWith('.jsonl'))\n                    .sort()\n                    .reverse();\n                if (files.length > 0 && this.store.activeRunId === null) {\n                    this.store.activeRunId = files[0].replace(/\\.jsonl$/, '');\n                }\n            } catch { /* runs dir missing */ }\n        }\n        this._onDidChangeTreeData.fire();\n    }\n\n    setFunctionFilter(fnName: string | null): void {\n        this.store.focusedFn = fnName;\n        this._onDidChangeTreeData.fire();\n    }\n\n    invalidateRun(runId: string): void {\n        this.store.runTraces.delete(runId);\n        this._onDidChangeTreeData.fire();\n    }\n\n    getTreeItem(element: TraceRunItem | TraceCallItem): vscode.TreeItem {\n        return element;\n    }\n\n    getChildren(element?: TraceRunItem | TraceCallItem): vscode.ProviderResult<(TraceRunItem | TraceCallItem)[]> {\n        if (!element) {\n            const runsDir = getRunsDir();\n            if (!runsDir) { return []; }\n            let files: string[] = [];\n            try {\n                files = fs.readdirSync(runsDir)\n                    .filter(f => f.endsWith('.jsonl'))\n                    .sort()\n                    .reverse();\n            } catch { return []; }\n            return files.map(f => new TraceRunItem(f.replace(/\\.jsonl$/, '')));\n        }\n\n        if (element instanceof TraceRunItem) {\n            const runId = element.runId;\n            if (!this.store.runTraces.has(runId)) {\n                const runsDir = getRunsDir();\n                if (!runsDir) { return []; }\n                const traces = loadTracesFromFile(path.join(runsDir, `${runId}.jsonl`));\n                this.store.runTraces.set(runId, traces);\n            }\n            const traces = this.store.runTraces.get(runId) ?? [];\n            return traces.map(t => new TraceCallItem(t, runId));\n        }\n\n        return [];\n    }\n\n    getParent(element: TraceRunItem | TraceCallItem): vscode.ProviderResult<TraceRunItem | null> {\n        if (element instanceof TraceRunItem) { return null; }\n        if (element instanceof TraceCallItem) { return new TraceRunItem(element.runId); }\n        return null;\n    }\n}\n\n// ---------------------------------------------------------------------------\n// TraceDetailProvider\n// ---------------------------------------------------------------------------\n\nclass DetailItem extends vscode.TreeItem {\n    constructor(\n        label: string,\n        description?: string,\n        collapsible = vscode.TreeItemCollapsibleState.None,\n        public readonly children: DetailItem[] = []\n    ) {\n        super(label, collapsible);\n        this.description = description;\n        this.contextValue = 'detailItem';\n    }\n}\n\nclass TraceDetailProvider implements vscode.TreeDataProvider<DetailItem> {\n    private _onDidChangeTreeData = new vscode.EventEmitter<void>();\n    readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n    private _items: DetailItem[] = [];\n\n    showTrace(trace: TraceRecord | null): void {\n        if (!trace) {\n            this._items = [];\n            this._onDidChangeTreeData.fire();\n            return;\n        }\n\n        const items: DetailItem[] = [];\n        items.push(new DetailItem('duration', `${trace.duration_s.toFixed(3)}s`));\n\n        const ts = new Date(trace.timestamp_start * 1000);\n        items.push(new DetailItem('called at', ts.toLocaleTimeString()));\n\n        const inputEntries = Object.entries(trace.inputs);\n        if (inputEntries.length === 0) {\n            items.push(new DetailItem('inputs', '(none)'));\n        } else {\n            const inputChildren = inputEntries.map(([k, v]) => {\n                const valStr = JSON.stringify(v);\n                if (typeof v === 'object' && v !== null) {\n                    const nested = this._buildObjectNodes(v as Record<string, unknown>);\n                    return new DetailItem(\n                        k, nested.length > 0 ? undefined : valStr,\n                        nested.length > 0 ? vscode.TreeItemCollapsibleState.Collapsed : vscode.TreeItemCollapsibleState.None,\n                        nested\n                    );\n                }\n                return new DetailItem(k, valStr);\n            });\n            items.push(new DetailItem('inputs', undefined, vscode.TreeItemCollapsibleState.Expanded, inputChildren));\n        }\n\n        if (trace.error) {\n            const errChildren = [\n                new DetailItem('type', trace.error.type),\n                new DetailItem('message', trace.error.message),\n            ];\n            items.push(new DetailItem('error', undefined, vscode.TreeItemCollapsibleState.Expanded, errChildren));\n        } else {\n            const outVal = trace.output;\n            if (typeof outVal === 'object' && outVal !== null) {\n                const nested = this._buildObjectNodes(outVal as Record<string, unknown>);\n                items.push(new DetailItem(\n                    'output', nested.length > 0 ? undefined : JSON.stringify(outVal),\n                    nested.length > 0 ? vscode.TreeItemCollapsibleState.Expanded : vscode.TreeItemCollapsibleState.None,\n                    nested\n                ));\n            } else {\n                items.push(new DetailItem('output', JSON.stringify(outVal)));\n            }\n        }\n\n        this._items = items;\n        this._onDidChangeTreeData.fire();\n    }\n\n    private _buildObjectNodes(obj: Record<string, unknown>): DetailItem[] {\n        return Object.entries(obj).map(([k, v]) => {\n            if (typeof v === 'object' && v !== null) {\n                const nested = this._buildObjectNodes(v as Record<string, unknown>);\n                return new DetailItem(\n                    k, nested.length > 0 ? undefined : JSON.stringify(v),\n                    nested.length > 0 ? vscode.TreeItemCollapsibleState.Collapsed : vscode.TreeItemCollapsibleState.None,\n                    nested\n                );\n            }\n            return new DetailItem(k, JSON.stringify(v));\n        });\n    }\n\n    getTreeItem(element: DetailItem): vscode.TreeItem { return element; }\n\n    getChildren(element?: DetailItem): DetailItem[] {\n        if (!element) { return this._items; }\n        return element.children;\n    }\n}\n\n// ---------------------------------------------------------------------------\n// AllTracesProvider\n// ---------------------------------------------------------------------------\n\nclass AllTracesProvider implements vscode.TreeDataProvider<TraceCallItem> {\n    private _onDidChangeTreeData = new vscode.EventEmitter<void>();\n    readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n    private _cachedItems: TraceCallItem[] = [];\n\n    constructor(private readonly store: TraceStore) {}\n\n    refresh(): void {\n        this._cachedItems = [];\n        this._onDidChangeTreeData.fire();\n    }\n\n    getTreeItem(element: TraceCallItem): vscode.TreeItem { return element; }\n\n    getParent(): null { return null; }\n\n    getChildren(): TraceCallItem[] {\n        if (!this.store.activeRunId) { this._cachedItems = []; return []; }\n        let traces = this.store.runTraces.get(this.store.activeRunId) ?? [];\n        if (this.store.focusedFn) {\n            traces = traces.filter(t => t.function === this.store.focusedFn);\n        }\n        this._cachedItems = traces.map(t =>\n            new TraceCallItem(t, this.store.activeRunId!, t.call_id === this.store.selectedCallId)\n        );\n        return this._cachedItems;\n    }\n}\n\n// ---------------------------------------------------------------------------\n// DecorationManager\n// ---------------------------------------------------------------------------\n\nclass DecorationManager {\n    private _highlight: vscode.TextEditorDecorationType;\n    private _gutter: vscode.TextEditorDecorationType;\n\n    constructor(\n        private readonly store: TraceStore,\n        context: vscode.ExtensionContext\n    ) {\n        this._highlight = vscode.window.createTextEditorDecorationType({\n            isWholeLine: true,\n            backgroundColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n            borderWidth: '0 0 0 3px',\n            borderStyle: 'solid',\n            borderColor: new vscode.ThemeColor('charts.blue'),\n            overviewRulerColor: new vscode.ThemeColor('charts.blue'),\n            overviewRulerLane: vscode.OverviewRulerLane.Right,\n        });\n\n        this._gutter = vscode.window.createTextEditorDecorationType({\n            gutterIconPath: context.asAbsolutePath('media/dot.svg'),\n            gutterIconSize: '60%',\n        });\n    }\n\n    applyToEditor(editor: vscode.TextEditor): void {\n        const { activeRunId, runTraces, focusedFn, selectedCallId, highlightActive } = this.store;\n        if (!activeRunId || !highlightActive) {\n            editor.setDecorations(this._highlight, []);\n            editor.setDecorations(this._gutter, []);\n            return;\n        }\n\n        const allTraces = runTraces.get(activeRunId) ?? [];\n        const filePath = editor.document.uri.fsPath;\n\n        const fileTraces = allTraces.filter(t => t.source_file === filePath && t.source_line_start !== null);\n        const gutterSeen = new Set<string>();\n        const gutterRanges: vscode.Range[] = [];\n        for (const t of fileTraces) {\n            if (!gutterSeen.has(t.function)) {\n                gutterSeen.add(t.function);\n                const decoratorLine = Math.max(0, t.source_line_start! - 2);\n                gutterRanges.push(new vscode.Range(decoratorLine, 0, decoratorLine, 0));\n            }\n        }\n\n        let highlightTraces = fileTraces;\n        if (focusedFn) {\n            highlightTraces = highlightTraces.filter(t => t.function === focusedFn);\n        } else if (selectedCallId) {\n            const selected = highlightTraces.filter(t => t.call_id === selectedCallId);\n            if (selected.length > 0) { highlightTraces = selected; }\n        }\n\n        const highlightRanges: vscode.Range[] = highlightTraces.map(t => {\n            const startLine = Math.max(0, t.source_line_start! - 2);\n            const endLine = t.source_line_end! - 1;\n            return new vscode.Range(startLine, 0, endLine, 0);\n        });\n\n        editor.setDecorations(this._highlight, highlightRanges);\n        editor.setDecorations(this._gutter, gutterRanges);\n    }\n\n    applyToAllVisibleEditors(): void {\n        for (const editor of vscode.window.visibleTextEditors) {\n            this.applyToEditor(editor);\n        }\n    }\n\n    clearAll(): void {\n        for (const editor of vscode.window.visibleTextEditors) {\n            editor.setDecorations(this._highlight, []);\n            editor.setDecorations(this._gutter, []);\n        }\n    }\n\n    dispose(): void {\n        this._highlight.dispose();\n        this._gutter.dispose();\n    }\n}\n\n// ---------------------------------------------------------------------------\n// TraceHoverProvider\n// ---------------------------------------------------------------------------\n\nclass TraceHoverProvider implements vscode.HoverProvider {\n    constructor(private readonly store: TraceStore) {}\n\n    provideHover(\n        document: vscode.TextDocument,\n        position: vscode.Position\n    ): vscode.ProviderResult<vscode.Hover> {\n        if (!this.store.activeRunId) { return undefined; }\n\n        const allTraces = this.store.runTraces.get(this.store.activeRunId) ?? [];\n        const filePath = document.uri.fsPath;\n        const cursorLine = position.line;\n\n        const matches = allTraces.filter(t =>\n            t.source_file === filePath &&\n            t.source_line_start !== null &&\n            t.source_line_end !== null &&\n            cursorLine >= Math.max(0, t.source_line_start - 2) &&\n            cursorLine <= t.source_line_end - 1\n        );\n\n        if (matches.length === 0) { return undefined; }\n\n        const fnName = matches[0].function;\n        const md = new vscode.MarkdownString();\n        md.isTrusted = true;\n        md.appendMarkdown(`### \\`${fnName}\\`\\n\\n`);\n\n        matches.forEach((t, i) => {\n            const ts = new Date(t.timestamp_start * 1000);\n            const timeStr = `${ts.getHours().toString().padStart(2, '0')}:${ts.getMinutes().toString().padStart(2, '0')}:${ts.getSeconds().toString().padStart(2, '0')}`;\n            md.appendMarkdown(`**Call ${i + 1}** \u2014 ${timeStr}  \\n`);\n\n            const inputsJson = JSON.stringify(t.inputs, null, 2);\n            const cappedInputs = inputsJson.length > 1000 ? inputsJson.slice(0, 1000) + '...' : inputsJson;\n            md.appendMarkdown(`**Inputs:**\\n\\`\\`\\`json\\n${cappedInputs}\\n\\`\\`\\`\\n`);\n\n            if (t.error) {\n                const errStr = typeof t.error === 'string' ? t.error : `${t.error.type}: ${t.error.message}`;\n                md.appendMarkdown(`**Error:** ${errStr}\\n\\n`);\n            } else {\n                const outputStr = JSON.stringify(t.output, null, 2);\n                const cappedOutput = outputStr.length > 1000 ? outputStr.slice(0, 1000) + '...' : outputStr;\n                md.appendMarkdown(`**Output:**\\n\\`\\`\\`\\n${cappedOutput}\\n\\`\\`\\`\\n`);\n            }\n\n            if (t.wandb_url) {\n                md.appendMarkdown(`[View in W&B](${t.wandb_url})\\n\\n`);\n            }\n\n            if (i < matches.length - 1) { md.appendMarkdown('\\n---\\n\\n'); }\n        });\n\n        const firstMatch = matches[0];\n        const hoverRange = new vscode.Range(\n            Math.max(0, firstMatch.source_line_start! - 2), 0,\n            firstMatch.source_line_end! - 1, 0\n        );\n\n        return new vscode.Hover(md, hoverRange);\n    }\n}\n\n// ---------------------------------------------------------------------------\n// activate\n// ---------------------------------------------------------------------------\n\nexport function activate(context: vscode.ExtensionContext) {\n    const store: TraceStore = {\n        activeRunId: null,\n        runTraces: new Map(),\n        selectedCallId: null,\n        focusedFn: null,\n        suppressCursorFilter: false,\n        highlightActive: true,\n    };\n\n    const provider = new TraceTreeProvider(store);\n    const allTracesProvider = new AllTracesProvider(store);\n    const detailProvider = new TraceDetailProvider();\n    const decorationManager = new DecorationManager(store, context);\n    const hoverProvider = new TraceHoverProvider(store);\n\n    const treeView = vscode.window.createTreeView('cdweaveTraceTree', {\n        treeDataProvider: provider,\n        showCollapseAll: true,\n    });\n    const allTracesView = vscode.window.createTreeView('cdweaveAllTraces', {\n        treeDataProvider: allTracesProvider,\n    });\n    const detailView = vscode.window.createTreeView('cdweaveTraceDetail', {\n        treeDataProvider: detailProvider,\n    });\n\n    const hoverDisposable = vscode.languages.registerHoverProvider(\n        { language: 'python' },\n        hoverProvider\n    );\n\n    const clearFocusCmd = vscode.commands.registerCommand(\n        'cdweave.clearFocus',\n        () => {\n            store.highlightActive = false;\n            store.focusedFn = null;\n            store.selectedCallId = null;\n            provider.setFunctionFilter(null);\n            allTracesProvider.refresh();\n            decorationManager.clearAll();\n        }\n    );\n\n    const openTraceUrlCmd = vscode.commands.registerCommand(\n        'cdweave.openTraceUrl',\n        (item: TraceCallItem) => {\n            const url = traceUrl(item.trace);\n            if (url) {\n                vscode.env.openExternal(vscode.Uri.parse(url));\n            } else {\n                vscode.window.showInformationMessage('CDWeave: No W&B URL available for this trace.');\n            }\n        }\n    );\n\n    const restoreRunCodeCmd = vscode.commands.registerCommand(\n        'cdweave.restoreRunCode',\n        async (item: TraceRunItem) => {\n            const gs = item.gitState;\n            if (!gs?.git_snapshot_sha || !gs.git_repo_root) {\n                vscode.window.showWarningMessage('CDWeave: No snapshot found for this run.');\n                return;\n            }\n            const shortSha = gs.git_snapshot_sha.slice(0, 8);\n            const choice = await vscode.window.showWarningMessage(\n                `Restore code from run \"${parseRunLabel(item.runId)}\"?\\n\\nThis will overwrite your working tree with snapshot ${shortSha}. Uncommitted changes will be lost.`,\n                { modal: true },\n                'Restore'\n            );\n            if (choice !== 'Restore') { return; }\n            try {\n                runGit(['checkout', gs.git_snapshot_sha, '--', '.'], gs.git_repo_root);\n                vscode.window.showInformationMessage(`CDWeave: Working tree restored to snapshot ${shortSha}.`);\n            } catch (e: unknown) {\n                const err = e as { message?: string };\n                vscode.window.showErrorMessage(`CDWeave: git checkout failed \u2014 ${err.message ?? String(e)}`);\n            }\n        }\n    );\n\n    const restoreMainCodeCmd = vscode.commands.registerCommand(\n        'cdweave.restoreMainCode',\n        async (item: TraceRunItem) => {\n            const gs = item.gitState;\n            if (!gs?.git_repo_root) {\n                vscode.window.showWarningMessage('CDWeave: No git repo info for this run.');\n                return;\n            }\n            const choice = await vscode.window.showWarningMessage(\n                `Reset working tree back to HEAD?\\n\\nThis will discard any uncommitted changes in ${gs.git_repo_root}.`,\n                { modal: true },\n                'Reset to HEAD'\n            );\n            if (choice !== 'Reset to HEAD') { return; }\n            try {\n                runGit(['checkout', 'HEAD', '--', '.'], gs.git_repo_root);\n                vscode.window.showInformationMessage('CDWeave: Working tree reset to HEAD.');\n            } catch (e: unknown) {\n                const err = e as { message?: string };\n                vscode.window.showErrorMessage(`CDWeave: git checkout failed \u2014 ${err.message ?? String(e)}`);\n            }\n        }\n    );\n\n    const selectTraceCmd = vscode.commands.registerCommand(\n        'cdweave.selectTrace',\n        async (item: TraceCallItem) => {\n            store.activeRunId = item.runId;\n            store.selectedCallId = item.trace.call_id;\n            store.focusedFn = item.trace.function;\n            store.suppressCursorFilter = true;\n            store.highlightActive = true;\n\n            const runsDir = getRunsDir();\n            if (runsDir && !store.runTraces.has(item.runId)) {\n                store.runTraces.set(item.runId, loadTracesFromFile(path.join(runsDir, `${item.runId}.jsonl`)));\n            }\n\n            allTracesProvider.refresh();\n            detailProvider.showTrace(item.trace);\n\n            try {\n                const doc = await vscode.workspace.openTextDocument(vscode.Uri.file(item.trace.source_file!));\n                const editor = await vscode.window.showTextDocument(doc, { preserveFocus: false, preview: false });\n                const decoratorLine = Math.max(0, item.trace.source_line_start! - 2);\n                editor.revealRange(\n                    new vscode.Range(decoratorLine, 0, decoratorLine, 0),\n                    vscode.TextEditorRevealType.InCenterIfOutsideViewport\n                );\n                decorationManager.applyToAllVisibleEditors();\n            } catch {\n                vscode.window.showErrorMessage(`CDWeave: Could not open ${item.trace.source_file}`);\n            }\n        }\n    );\n\n    const workspaceFolders = vscode.workspace.workspaceFolders;\n    let watcher: vscode.FileSystemWatcher | undefined;\n    if (workspaceFolders && workspaceFolders.length > 0) {\n        watcher = vscode.workspace.createFileSystemWatcher('**/runs/*.jsonl');\n\n        watcher.onDidCreate(() => {\n            provider.refresh();\n            allTracesProvider.refresh();\n        });\n\n        watcher.onDidChange((uri) => {\n            const runId = path.basename(uri.fsPath, '.jsonl');\n            provider.invalidateRun(runId);\n            const runsDir = getRunsDir();\n            if (runId === store.activeRunId && runsDir) {\n                store.runTraces.set(runId, loadTracesFromFile(uri.fsPath));\n                allTracesProvider.refresh();\n                decorationManager.applyToAllVisibleEditors();\n            }\n        });\n\n        watcher.onDidDelete((uri) => {\n            const runId = path.basename(uri.fsPath, '.jsonl');\n            store.runTraces.delete(runId);\n            if (store.activeRunId === runId) {\n                store.activeRunId = null;\n                store.selectedCallId = null;\n                decorationManager.clearAll();\n            }\n            provider.refresh();\n            allTracesProvider.refresh();\n        });\n\n        context.subscriptions.push(watcher);\n    }\n\n    vscode.window.onDidChangeActiveTextEditor((editor) => {\n        if (editor && store.activeRunId) {\n            decorationManager.applyToEditor(editor);\n        }\n    }, null, context.subscriptions);\n\n    vscode.window.onDidChangeTextEditorSelection((event) => {\n        if (!store.activeRunId) { return; }\n        if (store.suppressCursorFilter) {\n            store.suppressCursorFilter = false;\n            return;\n        }\n\n        const editor = event.textEditor;\n        const cursorLine = event.selections[0].active.line;\n        const traces = store.runTraces.get(store.activeRunId) ?? [];\n        const filePath = editor.document.uri.fsPath;\n\n        const hit = traces.find(t =>\n            t.source_file === filePath &&\n            t.source_line_start !== null &&\n            t.source_line_end !== null &&\n            cursorLine >= Math.max(0, t.source_line_start - 2) &&\n            cursorLine <= t.source_line_end - 1\n        );\n\n        const fnName = hit ? hit.function : null;\n        if (fnName !== store.focusedFn) {\n            provider.setFunctionFilter(fnName);\n            allTracesProvider.refresh();\n            decorationManager.applyToEditor(editor);\n        }\n    }, null, context.subscriptions);\n\n    provider.refresh();\n    allTracesProvider.refresh();\n\n    if (store.activeRunId) {\n        decorationManager.applyToAllVisibleEditors();\n    }\n\n    context.subscriptions.push(\n        treeView,\n        allTracesView,\n        detailView,\n        hoverDisposable,\n        clearFocusCmd,\n        openTraceUrlCmd,\n        restoreRunCodeCmd,\n        restoreMainCodeCmd,\n        selectTraceCmd,\n        { dispose: () => decorationManager.dispose() }\n    );\n}\n\nexport function deactivate() {}\n"],
  "mappings": "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",
  "names": ["traces"]
}
